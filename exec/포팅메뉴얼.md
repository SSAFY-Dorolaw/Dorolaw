# ğŸš€ A501 DOROLAW í”„ë¡œì íŠ¸

## ğŸ“‹ 1. Gitlab ì†ŒìŠ¤ í´ë¡  ì´í›„ ë¹Œë“œ ë° ë°°í¬ ë¬¸ì„œ

### ğŸ”§ ê°œë°œ í™˜ê²½

#### ğŸ§© ì‹œìŠ¤í…œ êµ¬ì„± ìš”ì†Œ
- **í”„ë¡ íŠ¸ì—”ë“œ**: React ê¸°ë°˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
- **ë°±ì—”ë“œ**: Spring Boot REST API ì„œë²„
- **AI**: ê³¼ì‹¤ ë¹„ìœ¨ ë¶„ì„ ì„œë²„
- **Nginx**: ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ, í¬ì›Œë“œ í”„ë¡ì‹œ, HTTPS ì„¤ì •
- **MySQL**: RDB ë°ì´í„° CRUD
- **RabbitMQ**: AI ë¶„ì„ ì²˜ë¦¬ ë¹„ë™ê¸° ë…¼ë¸”ë¡œí‚¹ ì²˜ë¦¬
- **Prometheus**, **cAdvisor**, **Node-exporter**: ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ ë°ì´í„° ìˆ˜ì§‘
- **Grafana**: ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ ë°ì´í„° ì‹œê°í™”

#### ì‚¬ìš© ê¸°ìˆ  ìŠ¤íƒ ë° ë²„ì „
- **JVM**: Amazon Corretto 17 (ë¡œì»¬), amazoncorretto:17 (Docker)
- **ì›¹ì„œë²„**: 
  - React + Nginx (í”„ë¡ íŠ¸ì—”ë“œ)
  - nginx/1.27.4 (ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)
- **WAS**: Spring Boot ë‚´ì¥ Tomcat
- **IDE**:
  - Visual Studio Code 1.97
  - IntelliJ Ultimate 2024.3.3
- **ë¹Œë“œ ë„êµ¬**:
  - í”„ë¡ íŠ¸ì—”ë“œ: Vite 
  - ë°±ì—”ë“œ: Gradle 8.13
- **í”„ë ˆì„ì›Œí¬ ë° ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬**:
  - Spring Boot 3.4.2
  - React 19
- **ë°ì´í„°ë² ì´ìŠ¤**: MySQL 8.0.41
- **OS**: Ubuntu
- **RabbitMQ**: RabbitMQ 4.0.7
- **Prometheus**: Prometheus 3.3.0
- **Grafana**: Grafana 11.6.0



### ğŸ”‘ ë¹Œë“œ ì‹œ ì‚¬ìš©ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜
#### ë°±ì—”ë“œ(Spring Boot)
`application.yml`
```
# ì„œë²„ ì„¤ì •
server:
  servlet:
    session:
      timeout: 30m
  port: 8080 # ë°±ì—”ë“œ í¬íŠ¸

# ë¡œê¹… ì„¤ì •
logging:
  level:
    org.hibernate.SQL: DEBUG # SQL ì¿¼ë¦¬ ë¡œê¹…
    org.hibernate.orm.jdbc.bind: TRACE # SQL íŒŒë¼ë¯¸í„° ë¡œê¹…
    org.springframework.boot.autoconfigure.logging: ERROR # ìŠ¤í”„ë§ ë¶€íŠ¸ ìë™ì„¤ì • ë¡œê¹…

spring:
  application:
    name: dorolaw

  # mysql ì„¤ì •
  datasource:
    url: jdbc:mysql://{{ë°°í¬ë„ë©”ì¸}}:3306/dorolaw?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: {{dbì•„ì´ë””}}
    password: {{ë¹„ë°€ë²ˆí˜¸}}
    driver-class-name: com.mysql.cj.jdbc.Driver

  # jpa ì„¤ì •
  jpa:
    hibernate:
      ddl-auto: update  # í…Œì´ë¸” ì—†ëŠ” ê²½ìš° ìë™ ìƒì„±
      jdbc:
        time_zone: Asia/Seoul
    show-sql: true # ì‹¤í–‰ë˜ëŠ” sqlë¬¸ ì¶œë ¥
	
	jackson:
    time-zone: Asia/Seoul
	
	
  # ì¹´ì¹´ì˜¤ ì†Œì…œ ë¡œê·¸ì¸ ì„¤ì •
  security:
    oauth2:
      client:
        registration:
          kakao:
            client-id: {{ì¹´ì¹´ì˜¤ id}}
            client-secret: {{ì¹´ì¹´ì˜¤ secreteId(ì„ íƒ)}}
            client-authentication-method: client_secret_post
            redirect-uri: "https://{{ë„ë©”ì¸}}/api/login/oauth2/code/{registrationId}"
            authorization-grant-type: authorization_code
            scope: profile_image, account_email, name, phone_number
        provider:
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri: https://kauth.kakao.com/oauth/token
            user-info-uri: https://kapi.kakao.com/v2/user/me
            user-name-attribute: id

  # Local Cache ì„¤ì •
  cache:
    type: simple

  # ì–¼ë¡œë“œ ê°€ëŠ¥í•œ ìµœëŒ€ ì˜ìƒ ë©”ëª¨ë¦¬
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB

  # RabbitMQ
  rabbitmq:
    host: rabbitmq
    port: 5672
    username: guest
    password: guest
    connection-timeout: 10000
    template:
      retry:
        enabled: true
        initial-interval: 1000
        max-attempts: 5
        multiplier: 1.0

  # cors ì„¤ì •
  main:
    allow-bean-definition-overriding: true

# JWT ì„¤ì •
jwt:
  secret: jwtsecretkeyajwtsecretkeybjwtsecretkeycjwtsecretkeydjwtsecretkeye
  expiration: 86400000  # ë§Œë£Œì‹œê°„

# ì¹´ì¹´ì˜¤í˜ì´ ì„¤ì •
kakaoPay:
  secretKey: DEV0F58DA8968BA95F18CF27A7A5124A7E959CC7

# CORS ì„¤ì •
cors:
  allowed-origins: http://localhost:5173,http://localhost:3000,http://localhost:5000,https://{{ë„ë©”ì¸}},https://{{ë°°í¬ ë„ë©”ì¸}}/ai
  allowed-methods: GET,POST,PUT,DELETE,OPTIONS,PATCH,HEAD
  allowed-headers: Authorization,Content-Type,X-Requested-With,Accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers,X-Auth-Token,X-XSRF-TOKEN,Cache-Control,Pragma,X-Frame-Options,X-Content-Type-Options,Strict-Transport-Security,Access-Control-Allow-Origin,Access-Control-Allow-Methods,Access-Control-Allow-Headers,Access-Control-Max-Age,Access-Control-Expose-Headers,Access-Control-Allow-Credentials,X-Custom-Header,Referer,User-Agent

# EC2 ì˜ìƒ ê²½ë¡œ
file:
  uploadDir: {{ec2ë‚´ ì˜ìƒ ì €ì¥ ê²½ë¡œ}}

# ë””ë²„ê¹…
debug: true

# í”„ë¡ íŠ¸ ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸
app:
  frontend:
    url: https://{{ë°°í¬ ë„ë©”ì¸}}	
```

`firebase-service-account.json`
```
{
  "type": "service_account",
  "project_id": {{êµ¬ê¸€í´ë¼ìš°ë“œ í”„ë¡œì íŠ¸id}},
  "private_key_id": {{êµ¬ê¸€í´ë¼ìš°ë“œ key id}},
  "private_key": {{êµ¬ê¸€í´ë¼ìš°ë“œ private key}},
  "client_email": {{êµ¬ê¸€í´ë¼ìš°ë“œ email}},
  "client_id": {{êµ¬ê¸€í´ë¼ìš°ë“œ client id}},
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-fbsvc%40myproject-e9c73.iam.gserviceaccount.com",
  "universe_domain": "googleapis.com"
}
```



#### í”„ë¡ íŠ¸ì—”ë“œ(React)

`.env` 
```
VITE_API_URL = https://{{ë°°í¬ ë„ë©”ì¸}}/api
VITE_API_LOCAL_URL = http://localhost:8080/api

VITE_KAKAO_REDIRECT_URI = https://j12a501.p.ssafy.io/api/oauth2/authorization/kakao
VITE_KAKAO_LOCAL_REDIRECT_URI = http://localhost:8080/oauth2/authorization/kakao

# Firebase configuration
VITE_FIREBASE_API_KEY={{êµ¬ê¸€í´ë¼ìš°ë“œ ì•± API_KEY}}
VITE_FIREBASE_AUTH_DOMAIN={{{{êµ¬ê¸€í´ë¼ìš°ë“œ ì•± AUTH_DOMAIN}}
VITE_FIREBASE_PROJECT_ID={{êµ¬ê¸€í´ë¼ìš°ë“œ ì•± PROJECT_ID}}
VITE_FIREBASE_STORAGE_BUCKET={{êµ¬ê¸€í´ë¼ìš°ë“œ ì•± STORAGE_BUCKET}}
VITE_FIREBASE_MESSAGING_SENDER_ID={{êµ¬ê¸€í´ë¼ìš°ë“œ ì•± MESSAGING_SENDER_ID}}
VITE_FIREBASE_APP_ID={{êµ¬ê¸€í´ë¼ìš°ë“œ ì•± APP_ID}}
VITE_FIREBASE_MEASUREMENT_ID={{êµ¬ê¸€í´ë¼ìš°ë“œ ì•± MEASUREMENT_ID}}
VITE_FIREBASE_VAPID_KEY={{êµ¬ê¸€í´ë¼ìš°ë“œ ì•± VAPID_KEY}}
```



### ğŸš¢ ë¹Œë“œ ë° ë°°í¬ ë°©ë²•

#### Jenkins CI/CD êµ¬ì„±
- Jenkins ì„œë²„ ì ‘ê·¼ í¬íŠ¸: 8080
- ë°°í¬ ê³¼ì •:
  1. Jenkins credentialsì—ì„œ Gitlab í† í°ê°’ ë¡œë”©
  2. SSH ê³µê°œ í‚¤ë¥¼ ì´ìš©í•˜ì—¬ ì„œë²„ ì ‘ì†
  3. ìµœì‹  ì½”ë“œ pull
  4. ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€: `docker-compose down`
  5. ìºì‹œ ì—†ì´ ë¹Œë“œ: `docker-compose build --no-cache`
  6. ì»¨í…Œì´ë„ˆ ì‹¤í–‰: `docker-compose up -d`

### ğŸ³ Docker êµ¬ì„±
- `docker-compose.yml`ë¡œ ê´€ë¦¬ë˜ëŠ” 4ê°œì˜ ì»¨í…Œì´ë„ˆ:
  1. `frontend`: React + Nginx (í¬íŠ¸: 3000)
  2. `backend`: Spring Boot (í¬íŠ¸: 8080)
  3. `ai`: ì„ë² ë””ë“œ ì‹œìŠ¤í…œ ì„œë²„ (í¬íŠ¸: 5000)
  4. `nginx`: ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„œë²„ (í¬íŠ¸: 80, 443)
  5. `rabbitmq`: ë©”ì„¸ì§€ í (í¬íŠ¸: 5672, 15672)
  5. `prometheus` ë©”íŠ¸ë¦­ ë°ì´í„° ì¢…í•© ìˆ˜ì§‘ ì„œë²„ (í¬íŠ¸: 9090)
  6. `cAdvisor`: docker ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ ë°ì´í„° ìˆ˜ì§‘ ì„œë²„ (í¬íŠ¸: 8080)
  7. `Node Exporter`: EC2 ë©”íŠ¸ë¦­ ë°ì´í„° ìˆ˜ì§‘ ì„œë²„ (í¬íŠ¸: 9100)
  8. `grafana`: ë©”íŠ¸ë¦­ ë°ì´í„° ì‹œê°í™” ì„œë²„ (í¬íŠ¸: 3000)
  

### ğŸ”„ Nginx ì„¤ì • (ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)
- HTTPS ë¦¬ë‹¤ì´ë ‰ì…˜ ë° SSL ì„¤ì •
- Let's Encrypt SSL ì¸ì¦ì„œ ì‚¬ìš©
- ìš”ì²­ ì œí•œ(rate limiting) êµ¬ì„±:
  - ì¼ë°˜ ì ‘ê·¼: 30 ìš”ì²­/ë¶„ (burst=30)
  - API ì ‘ê·¼: 60 ìš”ì²­/ë¶„ (burst=20)
  - ìŠ¤íŠ¸ë¦¼ ì ‘ê·¼: 5 ìš”ì²­/ë¶„ (burst=5)
- ì£¼ìš” í”„ë¡ì‹œ ê²½ë¡œ:



### âš ï¸ ë°°í¬ ì‹œ íŠ¹ì´ì‚¬í•­

#### ì¸í”„ë¼ 
1. portê°€ ì—´ë ¤ ìˆì–´ì•¼ í•¨
  - 22(ssh) 
  - 80(http) 
  - 443(https)
  - 3306(MySQL)
  - 8080(Jenkins)

2. MySQL ì„¤ì¹˜ í•„ìš”

3. SSL ì„¤ì •

   * /nginx/ssl/fullchain.pem
   * /nginx/ssl/privkey.pem

   

#### ë°±ì—”ë“œ
1. êµ¬ê¸€ í´ë¼ìš°ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± í•„ìš”
2. ì¹´ì¹´ì˜¤ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± í•„ìš”
4. backend/src/main/resourcesì— application.yml ìœ„ì¹˜ ë° ê°’ ì‘ì„± í•„ìš” (`{{}}` í‘œì‹œëœ ê°’ë§Œ ìˆ˜ì •í•˜ë©´ ë¨)
5. backend/src/main/resourcesì— `firebase-service-account.json`ìœ„ì¹˜ ë° ê°’ ì‘ì„± í•„ìš” (`{{}}` í‘œì‹œëœ ê°’ë§Œ ìˆ˜ì •í•˜ë©´ ë¨)



#### í”„ë¡ íŠ¸ì—”ë“œ

1. frontendì— `.env` íŒŒì¼ ìœ„ì¹˜ ë° ê°’ ì‘ì„± í•„ìš”



#### AI

1. ì´ë¯¸ì§€ íŒŒì¼(ai_image.tar, 16GB) ë‹¤ìš´ë¡œë“œ í›„ ì´ë¯¸ì§€ ë¡œë“œ í•„ìš”
	- docker load -i ai_image.tar



### ğŸ“¦ í”„ë¡œì íŠ¸ ì¢…ì†ì„±

#### ë°±ì—”ë“œ ì¢…ì†ì„±
```
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.4.3'
    id 'io.spring.dependency-management' version '1.1.7'
}

group = 'com.dorolaw'
version = '0.0.1-SNAPSHOT'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}

repositories {
    mavenCentral()
}

dependencies {
    // Spring Boot ê¸°ë³¸ ìŠ¤íƒ€í„°
    implementation 'org.springframework.boot:spring-boot-starter'

    // Lombok
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    // rest api
    implementation 'org.springframework.boot:spring-boot-starter-web'

    // ì¸ì¦, ì¸ê°€
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-client'

    // JWT
    implementation 'io.jsonwebtoken:jjwt-api:0.11.2'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.11.2'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.11.2'

    // MySQL Connector
    runtimeOnly 'mysql:mysql-connector-java:8.0.33'

    // JPA
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'

    // Local Cache
    implementation 'org.springframework.boot:spring-boot-starter-cache'
    implementation 'com.github.ben-manes.caffeine:caffeine:2.9.1'

    // firebase Admin SDK
    implementation 'com.google.firebase:firebase-admin:9.1.1'

    // í…ŒìŠ¤íŠ¸
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'

    // í…œí”Œë¦¿ ì—”ì§„ (ì„ íƒì‚¬í•­ - Thymeleaf)
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'

    // RabbitMQ
    implementation 'org.springframework.boot:spring-boot-starter-amqp'
}

tasks.named('test') {
    useJUnitPlatform()
}
```



#### í”„ë¡ íŠ¸ ì¢…ì†ì„±

`package.json`
```
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@eslint/compat": "^1.2.7",
    "@radix-ui/react-dropdown-menu": "^2.1.6",
    "@radix-ui/react-slot": "^1.1.2",
    "@tanstack/react-query": "^5.69.0",
    "@tanstack/react-query-devtools": "^5.69.0",
    "axios": "^1.8.4",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^3.6.0",
    "firebase": "^11.6.0",
    "js-cookie": "^3.0.5",
    "lucide-react": "^0.483.0",
    "react": "^19.0.0",
    "react-calendar": "^5.1.0",
    "react-day-picker": "^8.10.1",
    "react-dom": "^19.0.0",
    "react-icons": "^5.5.0",
    "react-router-dom": "^7.4.0",
    "tailwind-merge": "^3.1.0",
    "tailwindcss-animate": "^1.0.7",
    "zustand": "^5.0.3"
  },
  "devDependencies": {
    "@eslint/js": "^9.23.0",
    "@tanstack/eslint-plugin-query": "^5.68.0",
    "@types/js-cookie": "^3.0.6",
    "@types/node": "^22.13.11",
    "@types/react": "^19.0.10",
    "@types/react-dom": "^19.0.4",
    "@vitejs/plugin-react": "^4.3.4",
    "autoprefixer": "^10.4.21",
    "eslint": "^9.23.0",
    "eslint-config-prettier": "^10.1.1",
    "eslint-plugin-prettier": "^5.2.3",
    "eslint-plugin-react": "^7.37.4",
    "eslint-plugin-react-hooks": "^5.1.0",
    "eslint-plugin-react-refresh": "^0.4.19",
    "eslint-plugin-tailwindcss": "^3.18.0",
    "globals": "^15.15.0",
    "postcss": "^8.5.3",
    "prettier": "^3.5.3",
    "tailwindcss": "^3.4.17",
    "typescript": "~5.7.2",
    "typescript-eslint": "^8.27.0",
    "vite": "^6.2.0"
  }
}
```



## ğŸ”Œ 2. í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì™¸ë¶€ ì„œë¹„ìŠ¤ ì •ë³´

- ì¹´ì¹´ì˜¤
- FCM(êµ¬ê¸€ í´ë¼ìš°ë“œ)



## ğŸ’¾ 3. DB ì´ˆê¸°í™” ë° ë°ì´í„° ê´€ë¦¬

### ğŸ—„ï¸ ì´ˆê¸° ë°ì´í„° ìƒì„±
ì‹¤í–‰í•˜ë©´ ìë™ ìƒì„±ë¨

### ğŸ“ ì£¼ìš” ê³„ì • ë° í”„ë¡œí¼í‹° íŒŒì¼
DB ê³„ì • ìƒì„±í•˜ê³  application.ymlì— ë°˜ì˜ í•„ìš”